package info.kwarc.sally;

import java.io.FileReader;
import java.io.FileWriter;

import info.kwarc.sally.core.SallyInteraction;
import info.kwarc.sally.injection.Configuration;
import info.kwarc.sally.networking.CometD;
import info.kwarc.sally.networking.ConnectionManager;
import info.kwarc.sally.networking.ConnectionPlayer;
import info.kwarc.sally.networking.ConnectionRecorder;
import info.kwarc.sally.networking.interfaces.IConnectionManager;
import info.kwarc.sally.planetary.Planetary;
import info.kwarc.sissi.bpm.BPMNUtils;
import info.kwarc.sissi.bpm.inferfaces.ISallyKnowledgeBase;
import info.kwarc.sissi.bpm.injection.ProductionRemoteKnowledgeBase;
import info.kwarc.sissi.bpm.injection.ProductionSallyActions;
import sally.AlexData;
import sally.CADAlexClick;
import sally.SallyFrame;
import sally.ScreenCoordinates;
import sally_comm.MessageUtils;

import com.google.inject.Guice;
import com.google.inject.Injector;

/**
 * This is a sample file to launch a process.
 */
public class ProcessMain {

	public static final void main(String[] args) throws Exception {
		Injector i = Guice.createInjector(
				new Configuration(),
				new ProductionRemoteKnowledgeBase(), 
				new ProductionSallyActions()
		);

		IConnectionManager realConn = i.getInstance(ConnectionManager.class);
		//ConnectionRecorder conn = new ConnectionRecorder(new FileWriter("rec.json"), realConn);
		
		ConnectionPlayer player = new ConnectionPlayer(new FileReader("rec.json"));

		//CometD cometD = new CometD(8181, realConn);
		//cometD.start();
		player.start(realConn);

/*		
		conn.newClient("spread");
		conn.newMessage("spread", MessageUtils.createDesktopSpreadsheetAlex());

		AlexData alexData = AlexData.newBuilder().setFileName("pipe-end.xls").setData("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DAoGCAEQFhgDEAEYARAZChAKDAoGCAEQFxgDEAEYARAZChAKDAoGCAEQGBgDEAEYARAZIAYKtAIKEAoMCgYIARAIGAQQARgBEBwKEAoMCgYIARAJGAQQARgBEB0KEAoMCgYIARAKGAQQARgBEB4KEAoMCgYIARALGAQQARgBEB4KEAoMCgYIARAMGAQQARgBEB4KEAoMCgYIARANGAQQARgBEB4KEAoMCgYIARAOGAQQARgBEB4KEAoMCgYIARAPGAQQARgBEB4KEAoMCgYIARAQGAQQARgBEB8KEAoMCgYIARARGAQQARgBEB8KEAoMCgYIARASGAQQARgBEB8KEAoMCgYIARATGAQQARgBEB8KEAoMCgYIARAUGAQQARgBEB8KEAoMCgYIARAVGAQQARgBEB8KEAoMCgYIARAWGAQQARgBEB8KEAoMCgYIARAXGAQQARgBEB8KEAoMCgYIARAYGAQQARgBEB8gBwpuChAKDAoGCAEQBxgBEAEYARAJChAKDAoGCAEQBxgCEAEYARAKChAKDAoGCAEQBxgDEAEYARALChAKDAoGCAEQBxgEEAEYARAMChAKDAoGCAEQBxgFEAEYARANChAKDAoGCAEQBxgGEAEYARAOIAMKtAIKEAoMCgYIARAIGAUQARgBECAKEAoMCgYIARAJGAUQARgBECAKEAoMCgYIARAKGAUQARgBECAKEAoMCgYIARALGAUQARgBECAKEAoMCgYIARAMGAUQARgBECAKEAoMCgYIARANGAUQARgBECAKEAoMCgYIARAOGAUQARgBECAKEAoMCgYIARAPGAUQARgBECAKEAoMCgYIARAQGAUQARgBECAKEAoMCgYIARARGAUQARgBECAKEAoMCgYIARASGAUQARgBECEKEAoMCgYIARATGAUQARgBECAKEAoMCgYIARAUGAUQARgBECAKEAoMCgYIARAVGAUQARgBECAKEAoMCgYIARAWGAUQARgBECAKEAoMCgYIARAXGAUQARgBECAKEAoMCgYIARAYGAUQARgBECAgCAqSAQoQCgwKBggBEAEYARABGAEQAAoQCgwKBggBEAEYAhABGAEQAAoQCgwKBggBEAEYAxABGAEQAAoQCgwKBggBEAEYBBABGAEQAAoQCgwKBggBEAEYBRABGAEQAAoQCgwKBggBEAEYBhABGAEQAAoQCgwKBggBEAEYBxABGAEQAAoQCgwKBggBEAEYCBABGAEQACAACrQCChAKDAoGCAEQCBgBEAEYARAPChAKDAoGCAEQCRgBEAEYARAPChAKDAoGCAEQChgBEAEYARAPChAKDAoGCAEQCxgBEAEYARAPChAKDAoGCAEQDBgBEAEYARAPChAKDAoGCAEQDRgBEAEYARAPChAKDAoGCAEQDhgBEAEYARAPChAKDAoGCAEQDxgBEAEYARAPChAKDAoGCAEQEBgBEAEYARAQChAKDAoGCAEQERgBEAEYARAQChAKDAoGCAEQEhgBEAEYARARChAKDAoGCAEQExgBEAEYARASChAKDAoGCAEQFBgBEAEYARASChAKDAoGCAEQFRgBEAEYARASChAKDAoGCAEQFhgBEAEYARATChAKDAoGCAEQFxgBEAEYARATChAKDAoGCAEQGBgBEAEYARATIAQSuAEKBAgACAESEAoMCgYIARAFGAEQARgBEAUSEAoMCgYIARAFGAIQARgBEAYSEAoMCgYIARAFGAMQARgBEAcSEAoMCgYIARAFGAQQARgBEAgaGAoMCgYIARAFGAEQARgBEggIAAgBEAAQARoYCgwKBggBEAUYAxABGAESCAgACAEQABADGhgKDAoGCAEQBRgCEAEYARIICAAIARAAEAIaGAoMCgYIARAFGAQQARgBEggIAAgBEAAQBCACEsYHCgoIBAgFCAYIBwgIEhAKDAoGCAEQCBgGEAEYARAiEhAKDAoGCAEQCRgGEAEYARAjEhAKDAoGCAEQChgGEAEYARAkEhAKDAoGCAEQCxgGEAEYARAlEhAKDAoGCAEQDBgGEAEYARAmEhAKDAoGCAEQDRgGEAEYARAnEhAKDAoGCAEQDhgGEAEYARAkEhAKDAoGCAEQDxgGEAEYARAnEhAKDAoGCAEQEBgGEAEYARAoEhAKDAoGCAEQERgGEAEYARApEhAKDAoGCAEQEhgGEAEYARAqEhAKDAoGCAEQExgGEAEYARArEhAKDAoGCAEQFBgGEAEYARArEhAKDAoGCAEQFRgGEAEYARAsEhAKDAoGCAEQFhgGEAEYARAtEhAKDAoGCAEQFxgGEAEYARAtEhAKDAoGCAEQGBgGEAEYARAtGiQKDAoGCAEQDhgGEAEYARIUCAQIBQgGCAcICBAPEBUQGRAeECAaJAoMCgYIARAYGAYQARgBEhQIBAgFCAYIBwgIEBMQFxAZEB8QIBokCgwKBggBEBcYBhABGAESFAgECAUIBggHCAgQExAVEBkQHxAgGiQKDAoGCAEQCxgGEAEYARIUCAQIBQgGCAcICBAPEBQQGBAeECAaJAoMCgYIARAQGAYQARgBEhQIBAgFCAYIBwgIEBAQFBAZEB8QIBokCgwKBggBEBEYBhABGAESFAgECAUIBggHCAgQEBAVEBkQHxAgGiQKDAoGCAEQChgGEAEYARIUCAQIBQgGCAcICBAPEBQQGRAeECAaJAoMCgYIARAPGAYQARgBEhQIBAgFCAYIBwgIEA8QFRAZEB4QIBokCgwKBggBEA0YBhABGAESFAgECAUIBggHCAgQDxAUEBkQHhAgGiQKDAoGCAEQDBgGEAEYARIUCAQIBQgGCAcICBAPEBQQGhAeECAaJAoMCgYIARATGAYQARgBEhQIBAgFCAYIBwgIEBIQFBAZEB8QIBokCgwKBggBEBUYBhABGAESFAgECAUIBggHCAgQEhAVEBkQHxAgGiQKDAoGCAEQFBgGEAEYARIUCAQIBQgGCAcICBASEBQQGBAfECAaJAoMCgYIARASGAYQARgBEhQIBAgFCAYIBwgIEBEQFhAbEB8QIRokCgwKBggBEBYYBhABGAESFAgECAUIBggHCAgQExAUEBkQHxAgGiQKDAoGCAEQCBgGEAEYARIUCAQIBQgGCAcICBAPEBQQGBAcECAaJAoMCgYIARAJGAYQARgBEhQIBAgFCAYIBwgIEA8QFBAYEB0QICAJElQIBRJQaHR0cDovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9zaXNzaS9mbGFuZ2UvY2RzL3ByaWNlLm9tZG9jP3RocmVhZD9zY3Jldy10aHJlYWQSVwgBElNodHRwOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL3Npc3NpL2ZsYW5nZS9jZHMvcHJpY2Uub21kb2M/cHJpY2U/bWluaW11bS1wdXJjaGFzZRJNCAYSSWh0dHA6Ly90bnQua3dhcmMuaW5mby9yZXBvcy9zdGMvc2lzc2kvZmxhbmdlL2Nkcy9wcmljZS5vbWRvYz9jb2xvcj9jb2xvciASTQgHEklodHRwOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL3Npc3NpL2ZsYW5nZS9jZHMvcHJpY2Uub21kb2M/bnV0Ym9sdD9oZWFkEk8IAhJLaHR0cDovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9zaXNzaS9mbGFuZ2UvY2RzL3ByaWNlLm9tZG9jP3ByaWNlP2Rpc2NvdW50Ek4ICBJKaHR0cDovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9zaXNzaS9mbGFuZ2UvY2RzL3ByaWNlLm9tZG9jP3NvbGlkb2JqP3R5cGUSTQgAEklodHRwOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL3Npc3NpL2ZsYW5nZS9jZHMvcHJpY2Uub21kb2M/cHJpY2U/c2VsbGVyEkwICRJIaHR0cDovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9zaXNzaS9mbGFuZ2UvY2RzL3ByaWNlLm9tZG9jP3ByaWNlP3ByaWNlEk4IBBJKaHR0cDovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9zaXNzaS9mbGFuZ2UvY2RzL3ByaWNlLm9tZG9jP3NvbGlkb2JqP3R5cGU=").build();
		conn.newMessage("spread", alexData);

		conn.newClient("cad");
		conn.newMessage("cad", MessageUtils.createDesktopCADAlex());

		alexData = AlexData.newBuilder().setFileName("pipe-end.cad").setData("Cg9odHRwOi8vYmxhaC5jYWQSqgkKCHBpcGVfZW5kGqUCCgVib2x0MRJXaHR0cHM6Ly90bnQua3dhcmMuaW5mby9yZXBvcy9zdGMvZmNhZC9mbGFuZ2UvY2RzL0lTT2hleGJvbHQub21kb2M/SVNPaGV4Ym9sdD9JU09oZXhib2x0ImQKXWh0dHBzOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL2ZjYWQvZmxhbmdlL2Nkcy9JU09oZXh0aHJlYWQub21kb2M/SVNPaGV4dGhyZWFkP0lTT2hleHRocmVhZBIDTTE1Il0KVWh0dHBzOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL2ZjYWQvZmxhbmdlL2Nkcy9jb21wb25lbnRzLm9tZG9jP2NvbXBvbmVudD9jb21wb25lbnQSBGJvbHQapQIKBWJvbHQyEldodHRwczovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9mY2FkL2ZsYW5nZS9jZHMvSVNPaGV4Ym9sdC5vbWRvYz9JU09oZXhib2x0P0lTT2hleGJvbHQiZApdaHR0cHM6Ly90bnQua3dhcmMuaW5mby9yZXBvcy9zdGMvZmNhZC9mbGFuZ2UvY2RzL0lTT2hleHRocmVhZC5vbWRvYz9JU09oZXh0aHJlYWQ/SVNPaGV4dGhyZWFkEgNNMTUiXQpVaHR0cHM6Ly90bnQua3dhcmMuaW5mby9yZXBvcy9zdGMvZmNhZC9mbGFuZ2UvY2RzL2NvbXBvbmVudHMub21kb2M/Y29tcG9uZW50P2NvbXBvbmVudBIEYm9sdBqlAgoFYm9sdDMSV2h0dHBzOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL2ZjYWQvZmxhbmdlL2Nkcy9JU09oZXhib2x0Lm9tZG9jP0lTT2hleGJvbHQ/SVNPaGV4Ym9sdCJkCl1odHRwczovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9mY2FkL2ZsYW5nZS9jZHMvSVNPaGV4dGhyZWFkLm9tZG9jP0lTT2hleHRocmVhZD9JU09oZXh0aHJlYWQSA00xNSJdClVodHRwczovL3RudC5rd2FyYy5pbmZvL3JlcG9zL3N0Yy9mY2FkL2ZsYW5nZS9jZHMvY29tcG9uZW50cy5vbWRvYz9jb21wb25lbnQ/Y29tcG9uZW50EgRib2x0GqUCCgVib2x0NBJXaHR0cHM6Ly90bnQua3dhcmMuaW5mby9yZXBvcy9zdGMvZmNhZC9mbGFuZ2UvY2RzL0lTT2hleGJvbHQub21kb2M/SVNPaGV4Ym9sdD9JU09oZXhib2x0ImQKXWh0dHBzOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL2ZjYWQvZmxhbmdlL2Nkcy9JU09oZXh0aHJlYWQub21kb2M/SVNPaGV4dGhyZWFkP0lTT2hleHRocmVhZBIDTTE1Il0KVWh0dHBzOi8vdG50Lmt3YXJjLmluZm8vcmVwb3Mvc3RjL2ZjYWQvZmxhbmdlL2Nkcy9jb21wb25lbnRzLm9tZG9jP2NvbXBvbmVudD9jb21wb25lbnQSBGJvbHQ=").build();
		conn.newMessage("cad", alexData);

		SallyInteraction interaction = i.getInstance(SallyInteraction.class);
		interaction.registerServices(i.getInstance(Planetary.class));
		interaction.registerServices(i.getInstance(PricingService.class));

		CADAlexClick click = CADAlexClick.newBuilder().setFileName("pipe-end.cad").setCadNodeId("bolt1").setPosition(ScreenCoordinates.newBuilder().setX(100).setY(100).build()).build();
		conn.newMessage("cad", click);

		SallyFrame frame =  SallyFrame.newBuilder().setFileName("pipe-end.cad").build();
		conn.newMessage("cad", frame);
		*/
		//conn.close();
		BPMNUtils.showStatus(i.getInstance(ISallyKnowledgeBase.class).getKnowledgeSession());
	}

}